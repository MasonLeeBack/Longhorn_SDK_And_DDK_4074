<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 10">
<meta name=Originator content="Microsoft Word 10">
<link rel=File-List href="BDATuner_files/filelist.xml">
<title>BDA Sample Generic Tuner Driver</title>
<!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:GrammarState>Clean</w:GrammarState>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Verdana;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-alt:arial;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:536871559 0 0 0 415 0;}
@font-face
	{font-family:"MS Sans Serif";
	panose-1:0 0 0 0 0 0 0 0 0 0;
	mso-font-alt:"Times New Roman";
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:auto;
	mso-font-signature:0 0 0 0 0 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h2
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:2;
	font-size:18.0pt;
	font-family:"Times New Roman";
	font-weight:bold;}
h3
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:3;
	font-size:13.5pt;
	font-family:"Times New Roman";
	font-weight:bold;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
p
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
pre
	{margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";}
</style>
<![endif]-->
<meta name=Template content="C:\PROGRAM FILES\MICROSOFT OFFICE\OFFICE\html.dot">
</head>

<body lang=EN-US link=blue vlink=blue style='tab-interval:.5in' topmargin=0>

<div class=Section1>

<h2><a name=MYSAMPLE><span style='font-family:Verdana'>BDA Sample Generic Tuner
Driver</span></a><span style='font-family:Verdana'> <o:p></o:p></span></h2>

<h3><span style='font-family:Verdana'>SUMMARY<o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;font-family:Verdana'>This sample is the source
code for a generic tuner sample Broadcast Driver Architecture (BDA) driver for
Windows® XP. It is provided as an example of a BDA device minidriver for the
AVStream class of kernel streaming and to give hardware vendors assistance in
writing their own BDA minidrivers. This sample does not have any associated
hardware.<span style='mso-spacerun:yes'>  </span>The driver is designed to work
the sample BDA Capture driver.<o:p></o:p></span></p>

<h3><span style='font-family:Verdana'>BUILDING THE SAMPLE<o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;font-family:Verdana'>To build the sample, open
a DDK command window, change to the BDA directory, and use the <b>build</b>
command. The build command gets instructions on how to build from the <a
href="#sources">Sources file</a>. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>This sample can be built
as <span class=GramE>either an</span> ATSC, DVB-S, DVB-T or Open Cable sample.<span
style='mso-spacerun:yes'>  </span>To select the flavor of sample simply
uncomment the appropriate MACRO definition (ATSC_RECEIVER, DVBS_RECEIVER,
DVBT_RECEIVER or CABLE_RECEIVER) in BDATuner.h.<span
style='mso-spacerun:yes'>   </span>Make sure only one of the receiver type
MACROs is defined.<span style='mso-spacerun:yes'>  </span>Building this sample
produces one file : BDATuner.sys. Both free and checked versions can be built.<o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>The best way to use the
sample BDA tuner driver is to build both BDATuner.sys and BDACap.sys.<span
style='mso-spacerun:yes'>  </span>Follow the install instructions in
bdacap.htm. <span class=GramE>Briefly :</span> Using the hardware wizard first
install bdacap.sys and then bdatuner.sys.<o:p></o:p></span></p>

<h3><span style='font-family:Verdana'>TOOLS<o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;font-family:Verdana'>Open graphedt and insert
the following <span class=GramE>filters :</span> ATSC Network Provider (BDA
Network Provider category), Sample BDA Tuner (BDA Source Filters category),
Sample BDA CA Filter (BDA CP/CA Category) and the Sample BDA Capture Filter
(BDA Receiver Category). Right click and render the network provider. This will
build a graph pulling up the MPEG2 Demultiplexer, the Transport Information
Filter and the audio/video decoders (if they are installed).<o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>You can configure the
tuner filter to work as ATSC, DVB-S, DVB-T or Cable by uncommenting the right
macro in bdatuner.h. If you are hooking up a DVB-T Network Provider to a DVB-T
Tuner be sure to create a tuning space called “DVBT”. For DVB-S call the tuning
space “MYDVB” and for DVB-C call it “DVBC”. This name restriction applies only
if you use graph edit – if you are programmatically building a graph these
restrictions don’t apply. Further, to create a tuning space use the Tuning
Spaces tab on the property page. First <span class=GramE>time<span
style='mso-spacerun:yes'>  </span>you</span> create a tuning space also submit
a tune request with that tuning space. Otherwise the network provider <span
class=GramE>wont</span> connect to the tuner. To use the property pages you
should<span style='mso-spacerun:yes'>  </span>register proppage.dll.<o:p></o:p></span></p>

<h3><span style='font-family:Verdana'>RESOURCES<o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;font-family:Verdana'>To get a logo for your
device, consult the <a href="http://www.microsoft.com/hwtest">WHQL Web site</a>
for information and test suites.<o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>Your device should
support Plug and Play. Download Plug and Play specs from their <a
href="http://www.microsoft.com/hwdev/respec/pnpspecs.htm">Web site</a>.<o:p></o:p></span></p>

<h3><span style='font-family:Verdana'>CODE TOUR<o:p></o:p></span></h3>

<h4><span style='font-family:Verdana'>File Manifest<o:p></o:p></span></h4>

<pre><u>File<span style='mso-tab-count:2'>           </span><span style='mso-spacerun:yes'>     </span>Description<o:p></o:p></u></pre><pre><o:p>&nbsp;</o:p></pre><pre>Bdadebug.h<span
style='mso-tab-count:1'>     </span>Contains macros that the driver uses for debugging</pre><pre>BdaTuner.htm<span
style='mso-tab-count:1'>   </span>The documentation for this sample (this file)</pre><pre>Bdaguid.c<span
style='mso-tab-count:1'>      </span>Includes header files used for defining GUIDs</pre><pre>BDATuner.h<span
style='mso-tab-count:1'>     </span>Defines classes for filter, device, and filter I/O pins.</pre><pre>BDATuner.inf<span
style='mso-tab-count:1'>   </span>Installation information for the sample</pre><pre>BDATuner.rc<span
style='mso-tab-count:1'>    </span>Version information resource</pre><pre>Common.h<span
style='mso-tab-count:1'>       </span>Includes necessary header files, like Bdasup.h</pre><pre>Device.cpp<span
style='mso-tab-count:1'>     </span>Main code of BDA device, including driver-entry point</pre><pre>Filter.cpp<span
style='mso-tab-count:1'>     </span>Implements methods of the filter class </pre><pre>Inpin.cpp<span
style='mso-tab-count:1'>      </span>Implements the class for the input pin</pre><pre>Makefile<span
style='mso-tab-count:1'>       </span>The makefile for the project; do not edit.</pre><pre>ObjDesc.cpp<span
style='mso-tab-count:1'>    </span>Defines automation and dispatch tables and template structures</pre><pre>Outpin.cpp<span
style='mso-tab-count:1'>     </span>Implements the class for the output pin</pre><pre>Sources<span
style='mso-tab-count:1'> </span><span style='mso-spacerun:yes'>        </span>DDK build instructions</pre><pre>Splmedia.h<span
style='mso-tab-count:1'>     </span>Defines properties, methods, and events for </pre><pre><span style='mso-spacerun:yes'>                   </span><span
class=GramE>the</span> sample's nodes</pre><pre>Wdmdebug.h<span
style='mso-tab-count:1'>     </span>Contains macros for WDM debugging</pre><pre><o:p>&nbsp;</o:p></pre>

<h4 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='font-family:Verdana'>Programming Tour<o:p></o:p></span></h4>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='font-size:10.0pt;font-family:Verdana'>The ObjDesc.cpp file contains
definitions and templates that the network provider filter can use to determine
topology, to configure and change a filter instance, and to manipulate the
sample's nodes. The BDA sample software tuner driver registers these
definitions and templates with the BDA support library so the library can handle
most aspects of these operations. Other files of this sample define constants,
structures, and classes and implement methods for those classes. <o:p></o:p></span></p>

<h4 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><a
name=sources><span style='font-family:Verdana'>Sources File</span></a><span
style='font-family:Verdana'><o:p></o:p></span></h4>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='font-size:10.0pt;font-family:Verdana'>The <!--A HREF="sources"-->Sources<!--/a-->
file contains instructions on how to build the BDA sample software tuner
driver. The following code shows the macros used in the Sources file along with
comments that explain what those macros do.<o:p></o:p></span></p>

<pre><o:p>&nbsp;</o:p></pre><pre><span style='mso-tab-count:1'>        </span>TARGETNAME=<span
class=GramE>BDATuner<span style='mso-spacerun:yes'>  </span>#</span> Set driver's name</pre><pre><span
style='mso-tab-count:1'>        </span>TARGETTYPE=DRIVER<span style='mso-spacerun:yes'>    </span># Set type of file built, for example, program, DLL, or driver</pre><pre><span
style='mso-tab-count:1'>        </span><span style='mso-spacerun:yes'>             </span><span style='mso-spacerun:yes'>        </span># For BDA <span
class=GramE>minidriver,</span> set to DRIVER.</pre><pre><span style='mso-tab-count:
1'>        </span>TARGETPATH=obj$(BUILD_ALT_DIR<span class=GramE>)<span style='mso-spacerun:yes'>  </span>#</span> Set destination directory for the built file</pre><pre><span
style='mso-tab-count:1'>        </span> # Depending on whether your build environment is &quot;free&quot; or &quot;checked&quot;,</pre><pre><span
style='mso-tab-count:1'>        </span> # the BUILD_ALT_DIR variable appends &quot;fre&quot; or &quot;chk&quot; to the \obj subdirectory.</pre><pre><span
style='mso-tab-count:1'>        </span>DRIVERTYPE=<span class=GramE>WDM<span style='mso-spacerun:yes'>  </span>#</span> Set type of driver, can be set to either WDM or VXD.</pre><pre><span
style='mso-tab-count:1'>        </span><span style='mso-spacerun:yes'>                </span># For <span
class=GramE>BDA,</span> set to WDM.</pre><pre><o:p>&nbsp;</o:p></pre><pre><span
style='mso-tab-count:1'>        </span># Generate .SYM and .PDB (map) files.<span style='mso-spacerun:yes'>  </span>These files map names to addresses. </pre><pre><span
style='mso-tab-count:1'>        </span># <span class=GramE>Required</span> to debug on Win9x.</pre><pre><span
style='mso-tab-count:1'>        </span>USE_MAPSYM=1 <span style='mso-spacerun:yes'> </span></pre><pre><o:p>&nbsp;</o:p></pre><pre><span
style='mso-tab-count:1'>        </span># Point to the header files that the sample source requires. </pre><pre><span
style='mso-tab-count:1'>        </span>INCLUDES=<span class=GramE>..</span>\..\..\..\inc; \</pre><pre><span
style='mso-tab-count:1'>        </span><span style='mso-spacerun:yes'>  </span>$(DDK_INC_PATH)\wdm; </pre><pre><o:p>&nbsp;</o:p></pre><pre><span
style='mso-tab-count:1'>        </span># Point to the library files that the sample source requires. </pre><pre><span
style='mso-tab-count:1'>        </span>TARGETLIBS=<span class=GramE>..</span>\..\..\..\lib\ks.lib \</pre><pre><span
style='mso-tab-count:1'>        </span><span style='mso-spacerun:yes'>     </span>..\..\..\..\lib\ksguid.lib \</pre><pre><span
style='mso-tab-count:1'>        </span><span style='mso-spacerun:yes'>      </span>..\..\..\..\lib\BdaSup.lib</pre><pre><o:p>&nbsp;</o:p></pre><pre><span
style='mso-tab-count:1'>        </span># <span class=GramE>The</span> following macros are used with the Soft-ICE debugging tool.</pre><pre><span
style='mso-tab-count:1'>        </span>!ifdef BUILD_SOFTICE_SYMBOLS</pre><pre><span
style='mso-tab-count:1'>        </span>TARGETPATHEX=$(TARGETPATH)\$(TARGET_DIRECTORY)</pre><pre><o:p>&nbsp;</o:p></pre><pre><span
style='mso-tab-count:1'>        </span>NTTARGETFILES=$(TARGETPATH)\$(TARGETNAME).dbg</pre><pre><o:p>&nbsp;</o:p></pre><pre><span
style='mso-tab-count:1'>        </span>NTTARGETFILES=$(TARGETPATHEX)\$(TARGETNAME).nms $(NTTARGETFILES)</pre><pre><span
style='mso-tab-count:1'>        </span>!endif</pre><pre><o:p>&nbsp;</o:p></pre><pre><span
style='mso-tab-count:1'>        </span><span class=GramE># Sample source files that must be compiled.</span></pre><pre><span
style='mso-tab-count:1'>        </span>SOURCES= \</pre><pre><span
style='mso-tab-count:1'>        </span><span style='mso-spacerun:yes'>    </span>ObjDesc.cpp<span style='mso-spacerun:yes'>     </span>\</pre><pre><span
style='mso-tab-count:1'>        </span><span style='mso-spacerun:yes'>    </span>inpin.cpp<span style='mso-spacerun:yes'>     </span>\</pre><pre><span
style='mso-tab-count:1'>        </span><span style='mso-spacerun:yes'>    </span>outpin.cpp<span style='mso-spacerun:yes'>    </span>\</pre><pre><span
style='mso-tab-count:1'>        </span><span style='mso-spacerun:yes'>    </span>Filter.cpp<span style='mso-spacerun:yes'>      </span>\</pre><pre><span
style='mso-tab-count:1'>        </span><span style='mso-spacerun:yes'>    </span>Device.cpp<span style='mso-spacerun:yes'>      </span>\</pre><pre><span
style='mso-tab-count:1'>        </span><span style='mso-spacerun:yes'>    </span>bdaguid.c<span style='mso-spacerun:yes'>       </span>\</pre><pre><span
style='mso-tab-count:1'>        </span><span style='mso-spacerun:yes'>    </span>BDATuner.rc</pre>

<p align=center style='text-align:center;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='font-size:10.0pt;font-family:Verdana'><a href="#top">Top of page</a> <o:p></o:p></span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=624
 style='width:6.5in;mso-cellspacing:0in;mso-padding-alt:0in 5.4pt 0in 5.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-lastrow:yes;height:1.5pt'>
  <td style='background:aqua;padding:.75pt .75pt .75pt .75pt;height:1.5pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
 </tr>
</table>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='font-size:7.5pt;font-family:"MS Sans Serif"'>© 2000 Microsoft
Corporation</span><span style='font-size:10.0pt;font-family:Verdana'> <o:p></o:p></span></p>

</div>

</body>

</html>
